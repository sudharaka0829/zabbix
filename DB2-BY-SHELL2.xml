SELECT h.host AS hostname, i.lastvalue AS agent_version
FROM hosts h
JOIN items i ON h.hostid = i.hostid
WHERE i.key_ = 'agent.version';


SELECT h.host AS hostname, i.lastvalue AS agent_version
FROM hosts h
JOIN items i ON h.hostid = i.hostid
WHERE i.key_ = 'agent.version';


SELECT h.host AS hostname, h.lastip, h.hostid, 
       (SELECT lastvalue FROM history 
        WHERE itemid = i.itemid 
        ORDER BY clock DESC 
        LIMIT 1) AS agent_version
FROM hosts h
JOIN items i ON h.hostid = i.hostid
WHERE i.key_ = 'agent.version';